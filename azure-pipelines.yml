trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: Build
    displayName: 'Build Stage'
    jobs:
      - job: BuildJob
        displayName: 'Build and Test'
        steps:
          # Step 1: Install Maven 3.9.2
          - task: Maven@4
            inputs:
              mavenVersionOption: 'Custom'
              mavenVersion: '3.9.2'
              mavenSetM2Home: true

          # Step 2: Install Java 17
          - task: JavaToolInstaller@0
            inputs:
              versionSpec: '17'
              jdkArchitectureOption: 'x64'
              jdkSourceOption: 'PreInstalled'

          # Step 3: Maven build
          - task: Maven@4
            inputs:
              mavenPomFile: 'pom.xml'
              goals: 'clean package'
              javaHomeOption: 'JDKVersion'
              mavenVersionOption: 'Custom'
              publishJUnitResults: true
              testResultsFiles: '**/surefire-reports/TEST-*.xml'
